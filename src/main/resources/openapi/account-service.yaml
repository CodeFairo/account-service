openapi: 3.0.3
info:
  title: Account Service API
  version: 1.0.0
  description: >
    Simplified REST API for managing bank accounts (savings, checking, term).
    Optimized for exam presentation: only essential endpoints.
servers:
  - url: http://localhost:8081/api/v1
    description: Local development

tags:
  - name: Accounts
    description: Account management
  - name: Transactions
    description: Deposit, withdraw and balance
  - name: Transfers
    description: Transfer money between accounts

paths:
  /accounts:
    post:
      tags: [Accounts]
      summary: Create a new account
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AccountRequestDTO' }
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AccountDTO' }
              example:
                id: "acc-001"
                accountType: SAVINGS
                customerIds: ["cst-123"]
                balance: 1000.00
                status: ACTIVE
        '400': { description: Invalid input }
        '409': { description: Business rule violation }

    get:
      tags: [Accounts]
      summary: List accounts
      parameters:
        - in: query
          name: customerId
          schema: { type: string }
        - in: query
          name: accountType
          schema:
            type: string
            enum: [SAVINGS, CHECKING, TERM]
      responses:
        '200':
          description: List of accounts
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/AccountDTO' }

  /accounts/{accountId}:
    get:
      tags: [Accounts]
      summary: Get account by ID
      parameters:
        - name: accountId
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Account details
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AccountDTO' }
        '404': { description: Account not found }

  /accounts/{accountId}/deposit:
    post:
      tags: [Transactions]
      summary: Deposit money into an account
      parameters:
        - name: accountId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TransactionRequestDTO' }
      responses:
        '201':
          description: Deposit successful
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TransactionDTO' }
              example:
                id: "txn-100"
                type: DEPOSIT
                amount: 500.00
                balanceAfter: 1500.00
                timestamp: "2025-09-29T15:30:00Z"

  /accounts/{accountId}/withdraw:
    post:
      tags: [Transactions]
      summary: Withdraw money from an account
      parameters:
        - name: accountId
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TransactionRequestDTO' }
      responses:
        '201':
          description: Withdrawal successful
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TransactionDTO' }
              example:
                id: "txn-101"
                type: WITHDRAW
                amount: 200.00
                balanceAfter: 800.00
                timestamp: "2025-09-29T15:45:00Z"
        '409': { description: Insufficient funds }

  /accounts/{accountId}/balance:
    get:
      tags: [Transactions]
      summary: Get account balance
      parameters:
        - name: accountId
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Balance information
          content:
            application/json:
              schema:
                type: object
                properties:
                  accountId: { type: string }
                  availableBalance: { type: number, format: double }
              example:
                accountId: "acc-001"
                availableBalance: 800.00

  /accounts/{accountId}/transactions:
    get:
      tags: [Transactions]
      summary: List account transactions
      parameters:
        - name: accountId
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Transaction history
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/TransactionDTO' }

  /accounts/transfer:
    post:
      tags: [Transfers]
      summary: Transfer money between accounts
      description: >
        Performs a money transfer between two existing accounts.
        Generates a shared operation number and creates corresponding
        withdrawal and deposit transactions atomically.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TransferRequestDTO' }
            example:
              fromAccountId: "acc-001"
              toAccountId: "acc-002"
              amount: 250.00
              concept: "Payment to vendor"
      responses:
        '201':
          description: Transfer successful
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TransferDTO' }
              example:
                id: "trf-100"
                operationNumber: "2025100618453098"
                fromAccountId: "acc-001"
                toAccountId: "acc-002"
                amount: 250.00
                concept: "Payment to vendor"
                withdrawTransactionId: "txn-500"
                depositTransactionId: "txn-501"
                dateTransfer: "2025-10-06T18:45:30Z"
        '409': { description: Business rule violation (e.g. insufficient funds) }
        '400': { description: Invalid input }

components:
  schemas:
    AccountRequestDTO:
      type: object
      properties:
        accountType:
          type: string
          enum: [SAVINGS, CHECKING, TERM]
        customerIds:
          type: array
          items: { type: string }
        initialDeposit:
          type: number
          format: double
      required: [accountType, customerIds]

    AccountDTO:
      type: object
      properties:
        id: { type: string }
        accountType: { type: string }
        customerIds:
          type: array
          items: { type: string }
        balance: { type: number, format: double }
        status: { type: string, enum: [ACTIVE, CLOSED, BLOCKED] }
        minimumAverageBalance: { type: number, format: double }
        monthlyMovementLimit: { type: integer, format: int32  }
        movementsThisMonth: { type: integer, format: int32  }
        maintenanceFee: { type: number, format: double }
        operationDay: { type: string }

    TransactionRequestDTO:
      type: object
      properties:
        amount: { type: number, format: double }
        concept: { type: string }
      required: [amount]

    TransactionDTO:
      type: object
      properties:
        id: { type: string }
        operationNumber: { type: string }
        type: { type: string, enum: [DEPOSIT, WITHDRAW] }
        amount: { type: number, format: double }
        balanceAfter: { type: number, format: double }
        concept: { type: string }
        timestamp: { type: string, format: date-time }

    TransferRequestDTO:
      type: object
      properties:
        fromAccountId: { type: string }
        toAccountId: { type: string }
        amount: { type: number, format: double }
        concept: { type: string }
      required: [fromAccountId, toAccountId, amount]

    TransferDTO:
      type: object
      properties:
        id: { type: string }
        operationNumber: { type: string }
        fromAccountId: { type: string }
        toAccountId: { type: string }
        amount: { type: number, format: double }
        concept: { type: string }
        withdrawTransactionId: { type: string }
        depositTransactionId: { type: string }
        dateTransfer: { type: string, format: date-time }
